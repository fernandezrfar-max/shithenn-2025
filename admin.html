<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin Boutique</title>
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2;
    }

    header {
      background: black;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h3 {
      margin-top: 0;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
    }

    button {
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #333;
    }

    .productos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
    }

    .producto {
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }

    .producto img {
      width: 100%;
      height: 160px;
      object-fit: cover;
    }

    .producto-info {
      padding: 10px;
      font-size: 14px;
    }

    .estado {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .nuevo { color: green; }
    .agotado { color: red; }

    .acciones button {
      margin-top: 5px;
      font-size: 12px;
      padding: 6px;
    }

    .acciones .eliminar {
      background: #c0392b;
    }

    .acciones .agotado-btn {
      background: #f39c12;
    }

    .acciones .nuevo-btn {
      background: #27ae60;
    }
  </style>
</head>

<body>

<header>
  Panel de Administración - Boutique
</header>

<div class="container">

  <!-- FORMULARIO -->
  <div class="card">
    <h3>Subir producto</h3>

    <input type="text" id="nombre" placeholder="Nombre del producto">
    <input type="number" id="precio" placeholder="Precio">
    <input type="text" id="talla" placeholder="Talla (opcional)">
    <input type="url" id="imagen" placeholder="URL de la imagen">

    <button id="btnSubir">Subir producto</button>
  </div>

  <!-- LISTADO -->
  <div class="card">
    <h3>Productos publicados</h3>
    <div class="productos" id="listaProductos"></div>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    doc,
    updateDoc,
    deleteDoc
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDI8B6x2XEI9KEMVMKTgVS2sfylh9mGjd4",
    authDomain: "boutique-2025.firebaseapp.com",
    projectId: "boutique-2025",
    storageBucket: "boutique-2025.firebasestorage.app",
    messagingSenderId: "249111974538",
    appId: "1:249111974538:web:b7dc7b68c4b227c78e5373"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const nombreInput = document.getElementById("nombre");
  const precioInput = document.getElementById("precio");
  const tallaInput = document.getElementById("talla");
  const imagenInput = document.getElementById("imagen");
  const lista = document.getElementById("listaProductos");
  const btnSubir = document.getElementById("btnSubir");

  btnSubir.addEventListener("click", async () => {
    const nombre = nombreInput.value.trim();
    const precio = precioInput.value.trim();
    const talla = tallaInput.value.trim();
    const imagen = imagenInput.value.trim();

    if (!nombre || !precio || !imagen) {
      alert("Completa nombre, precio e imagen");
      return;
    }

    await addDoc(collection(db, "productos"), {
      nombre,
      precio,
      talla,
      imagen,
      estado: "activo",
      fecha: Date.now()
    });

    nombreInput.value = "";
    precioInput.value = "";
    tallaInput.value = "";
    imagenInput.value = "";
  });

  onSnapshot(collection(db, "productos"), (snapshot) => {
    lista.innerHTML = "";

    snapshot.forEach((docu) => {
      const p = docu.data();
      const id = docu.id;

      lista.innerHTML += `
        <div class="producto">
          <img src="${p.imagen}" alt="${p.nombre}">
          <div class="producto-info">
            <div class="estado ${p.estado === "agotado" ? "agotado" : "nuevo"}">
              ${p.estado}
            </div>
            <strong>${p.nombre}</strong><br>
            $${p.precio}<br>
            ${p.talla || ""}
            <div class="acciones">
              <button class="nuevo-btn" onclick="cambiarEstado('${id}','activo')">Nuevo</button>
              <button class="agotado-btn" onclick="cambiarEstado('${id}','agotado')">Agotado</button>
              <button class="eliminar" onclick="eliminarProducto('${id}')">Eliminar</button>
            </div>
          </div>
        </div>
      `;
    });
  });

  window.cambiarEstado = async (id, estado) => {
    await updateDoc(doc(db, "productos", id), { estado });
  };

  window.eliminarProducto = async (id) => {
    if (confirm("¿Eliminar este producto?")) {
      await deleteDoc(doc(db, "productos", id));
    }
  };
</script>

</body>
</html>

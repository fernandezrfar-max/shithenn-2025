<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Boutique</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; font-family:Arial; background:#f2f2f2; }
header { background:black; color:white; padding:15px; text-align:center; }
.container { display:grid; grid-template-columns:1fr 2fr; gap:20px; padding:20px; }
.card { background:white; padding:20px; border-radius:10px; }
input, button { width:100%; padding:10px; margin-bottom:10px; }
button { border:none; cursor:pointer; }
.productos { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:15px; }
.producto { border:1px solid #ddd; border-radius:8px; overflow:hidden; background:#fff; }
.producto img { width:100%; height:160px; object-fit:cover; }
.info { padding:10px; font-size:14px; }
.estado { font-weight:bold; text-transform:uppercase; }
.activo { color:green; }
.agotado { color:red; }
.eliminar { background:#c0392b; color:white; }
.agotado-btn { background:#f39c12; }
.activo-btn { background:#27ae60; }
</style>
</head>

<body>

<header>Panel de Administración – Sheitenn Boutique</header>

<div class="container">

<!-- FORMULARIO -->
<div class="card">
  <h3>Subir producto</h3>
  <input id="nombre" placeholder="Nombre">
  <input id="precio" type="number" placeholder="Precio">
  <input id="categoria" placeholder="Categoría (blusas, vestidos...)">
  <input id="imagen" placeholder="URL de imagen">
  <button id="btnSubir">Subir producto</button>
</div>

<!-- LISTADO -->
<div class="card">
  <h3>Productos</h3>
  <div class="productos" id="listaProductos"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  doc,
  updateDoc,
  deleteDoc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDI8B6x2XEI9KEMVMKTgVS2sfylh9mGjd4",
  authDomain: "boutique-2025.firebaseapp.com",
  projectId: "boutique-2025"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const lista = document.getElementById("listaProductos");

document.getElementById("btnSubir").onclick = async () => {
  if (!nombre.value || !precio.value || !categoria.value || !imagen.value) {
    alert("Completa todos los campos");
    return;
  }

  await addDoc(collection(db, "productos"), {
    nombre: nombre.value,
    precio: Number(precio.value),
    categoria: categoria.value.toLowerCase(),
    imagen: imagen.value,
    estado: "activo",
    fecha: Date.now()
  });

  nombre.value = precio.value = categoria.value = imagen.value = "";
};

const q = query(collection(db,"productos"), orderBy("fecha","desc"));

onSnapshot(q, snap => {
  lista.innerHTML = "";
  snap.forEach(d => {
    const p = d.data();
    lista.innerHTML += `
      <div class="producto">
        <img src="${p.imagen}">
        <div class="info">
          <div class="estado ${p.estado}">${p.estado}</div>
          <strong>${p.nombre}</strong><br>
          $${p.precio}<br>
          ${p.categoria}
          <button class="activo-btn" onclick="cambiarEstado('${d.id}','activo')">Activo</button>
          <button class="agotado-btn" onclick="cambiarEstado('${d.id}','agotado')">Agotado</button>
          <button class="eliminar" onclick="eliminarProducto('${d.id}')">Eliminar</button>
        </div>
      </div>`;
  });
});

window.cambiarEstado = (id, estado) =>
  updateDoc(doc(db,"productos",id),{estado});

window.eliminarProducto = id =>
  confirm("¿Eliminar producto?") &&
  deleteDoc(doc(db,"productos",id));
</script>

</body>
</html>
